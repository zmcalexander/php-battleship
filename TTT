<?php
session_start();
?>
<html>
<head>
<title>Battle Ship</title>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<meta name='txtweb-appkey' content ='1205be63-8293-4c02-82ce-17c500075e80' />
</head>
<body>
<?php
if(!empty($_GET['user'])){
    $user=$_GET['user'];
    if($user=='x'||$user=='X'){$com='O';}
    if($user=='o'||$user=='O'||$user=='0'){$user='O';$com='X';}
    $user=strtoupper($user);
    
    if(empty($_GET['move'])){
        
    }
    $grid=array();
    $grid[0]=array('   ','   ','   ');
    $grid[1]=array('   ','   ','   ');
    $grid[2]=array('   ','   ','   ');
    if(!empty($_GET['move'])){
        $usermove=$_GET['move'];
        $s=$_SESSION['usermove'];
        $pos=strpos($usermove,$s);
        if(!($pos===false)){echo 'This position is not empty!!';exit();}
        $s=$_SESSION['commove'];
        $pos=strpos($usermove,$s);
        if(!($pos===false)){echo 'This position is not empty!!';exit();}
        if(!empty($_SESSION['usermove'])){$_SESSION['usermove']=$_SESSION['usermove'].','.$usermove;}
        else{$_SESSION['usermove']=$usermove;}
        $moves=explode(',',$_SESSION['usermove']);
        foreach($moves as $value){
            switch($value){
                case '1':$grid[0][0]=' '.$user.' ';
                    break;
                case '2':$grid[0][1]=' '.$user.' ';
                    break;
                case '3':$grid[0][2]=' '.$user.' ';
                    break;
                case '4':$grid[1][0]=' '.$user.' ';
                    break;
                case '5':$grid[1][1]=' '.$user.' ';
                    break;
                case '6':$grid[1][2]=' '.$user.' ';
                    break;
                case '7':$grid[2][0]=' '.$user.' ';
                    break;
                case '8':$grid[2][1]=' '.$user.' ';
                    break;
                case '9':$grid[2][2]=' '.$user.' ';
                    break;
            }
        }
        if(strlen($moves)==1){
            $ran=rand(2,9);
            if($ran==$moves[0]){
                $ran=$ran-1;
            }
        }
        else{
            $ran=rand(1,9);
            $i=0;
            while(in_array($ran,$_SESSION['usermove'])){
                $ran=rand(1,9);
                $i++;
                if($i>=9){$ran=12;break;}
            }
        }
        if(!empty($_SESSION['commove'])){$_SESSION['commove']=$_SESSION['commove'].','.$ran;}
        else{$_SESSION['commove']=$ran;}
        $cmoves=explode(',',$_SESSION['commove']);
        foreach($cmoves as $value){
            switch($value){
                case '1':$grid[0][0]=' '.$com.' ';
                    break;
                case '2':$grid[0][1]=' '.$com.' ';
                    break;
                case '3':$grid[0][2]=' '.$com.' ';
                    break;
                case '4':$grid[1][0]=' '.$com.' ';
                    break;
                case '5':$grid[1][1]=' '.$com.' ';
                    break;
                case '6':$grid[1][2]=' '.$com.' ';
                    break;
                case '7':$grid[2][0]=' '.$com.' ';
                    break;
                case '8':$grid[2][1]=' '.$com.' ';
                    break;
                case '9':$grid[2][2]=' '.$com.' ';
                    break;
            }
        }
    }
	  echo 'Begin by entering the grid number of the desired target.';
    echo '<form action="',$_SERVER['PHP_SELF'],'" method="get" class="txtweb-form">';
    echo '(E.g.: B2 for 2nd row - 2nd column)<input type="text" name="move" />';
    echo '<input type="hidden" name="user" value="',$user,'" />';
    echo '<input type="submit" value="FIRE" /></form>';
    echo '<pre>';
	echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
	echo '| * | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10| * |<br />';
	echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
  echo '| A |',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][2],'|',$grid[0][2],'| A |<br />';
  echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
  echo '| B |',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][2],'|',$grid[0][2],'| B |<br />';
  echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
  echo '| C |',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][2],'|',$grid[0][2],'| C |<br />';
	echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
	echo '| D |',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][2],'|',$grid[0][2],'| D |<br />';
  echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
  echo '| E |',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][2],'|',$grid[0][2],'| E |<br />';
  echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
	echo '| F |',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][2],'|',$grid[0][2],'| F |<br />';
  echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
  echo '| G |',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][2],'|',$grid[0][2],'| G |<br />';
	echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
	echo '| H |',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][2],'|',$grid[0][2],'| H |<br />';
  echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
  echo '| I |',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][2],'|',$grid[0][2],'| I |<br />';
  echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
  echo '| J |',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][0],'|',$grid[0][1],'|',$grid[0][2],'|',$grid[0][2],'|',$grid[0][2],'| J |<br />';
	echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
	echo '| * | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10| * |<br />';
	echo '|---|---|---|---|---|---|---|---|---|---|---|---|<br />';
       echo '<form action="',$_SERVER['PHP_SELF'],'" method="get" class="txtweb-form">';
       echo '</body></html>';
    exit();
}
$_SESSION['usermove']='';
$_SESSION['commove']='';
echo '<h1>Welcome to BATTLESHIP</h1><br/>';
echo '<form action="'.$_SERVER['PHP_SELF'].'" method="get" class="txtweb-form">';
echo 'Enter an "X" and press PLAY to begin.<input type="text" name="user" />';
echo '<input type="submit" value="PLAY" /></form>';
?>
</body>
</html>
